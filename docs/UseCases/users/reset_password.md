# 비밀번호 재설정

## 1. 목적

사용자가 비밀번호를 안전하게 재설정하고, 계정에 접근할 수 있도록 하기

## 2. 주요 참여자

* 사용자
* 시스템

## 3. 선행 조건

* 사용자가 시스템에 이미 등록된 계정을 가지고 있어야 한다.
* 사용자가 등록된 이메일 주소에 접근할 수 있어야 한다.
* 시스템이 비밀번호 재설정 요청을 처리할 수 있는 상태여야 한다.

## 4. 후행 조건

* 사용자의 비밀번호가 성공적으로 재설정되어, 새로운 비밀번호로 로그인할 수 있게 된다.
* 비밀번호 재설정 토큰이 무효화되어 재사용되지 않는다.

## 5. 기본 흐름

1. 사용자는 웹사이트에서 "비밀번호 재설정" 링크를 클릭한다.
2. 시스템은 비밀번호 재설정 폼을 표시한다.
3. 사용자는 자신의 등록된 이메일 주소를 입력하고 "비밀번호 재설정 요청" 버튼을 클릭한다.
4. 시스템은 입력된 이메일 주소가 유효한지 검증한다.
   * 유효한 경우:
    1. 시스템은 고유한 비밀번호 재설정 토큰을 생성한다.
    2. 시스템은 생성된 토큰을 포함한 비밀번호 재설정 링크를 사용자에게 이메일로 전송한다.
    3. 시스템은 "비밀번호 재설정 링크가 이메일로 전송되었습니다. 이메일을 확인해주세요."라는 확인 메시지를 사용자에게 전송한다.
   * 유효하지 않은 경우:
     * 등록된 사용자가 아닐 경우
      1. 시스템은 "입력된 이메일 주소가 등록되지 않았습니다."라는 오류 메시지를 사용자에게 표시한다.
     * 이메일 형식이 아닐 경우:
      1. 시스템은 "유효한 이메일 주소를 입력해주세요."라는 메시지를 화면에 표시한다.
5. 사용자는 이메일로 전송된 비밀번호 재설정 링크를 클릭한다.
6. 시스템은 비밀번호 재설정 토큰의 유효설을 검증한다.
    * 유효한 경우:
        1. 시스템은 새로운 비밀번호를 입력할 수 있는 폼을 표시한다.
        2. 사용자는 새로운 비밀번호화 비밀번호 확인을 입력하고 "비밀번호 재설정" 버튼을 클릭한다.
        3. 시스템은 입력된 비밀번호를 검증하고, 비밀번호 재설정을 완료한다.
        4. 시스템은 "비밀번호가 성공적으로 재설정되었습니다. 로그인 해주세요."라는 확인 메시지를 사용자에게 표시한다.
    * 유효하지 않은 경우:
        1. 시스템은 "비밀번호 재설정 링크가 유효하지 않거나 만료되었습니다."라는 오류 메시지를 사용자에게 표시한다.
        2. 시스템은 비밀번호 재설정 요청 페이지로 리디렉션한다.

## 6. 대안 흐름

A1: 필수 필드 미입력

1. 사용자가 비밀번호 재설정 폼에서 이메일 주소를 입력하지 않고 “비밀번호 재설정 요청” 버튼을 클릭한다.
2. 시스템은 이메일 필드가 비어 있음을 강조하고, “이메일 주소를 입력해주세요.“라는 오류 메시지를 표시한다.
3. 사용자는 이메일 주소를 입력하고 다시 시도한다.

A2: 이메일 형식 불일치

1. 사용자가 비밀번호 재설정 폼에서 잘못된 형식의 이메일 주소를 입력하고 “비밀번호 재설정 요청” 버튼을 클릭한다.
2. 시스템은 “유효한 이메일 주소를 입력해주세요.“라는 오류 메시지를 표시한다.
3. 사용자는 올바른 이메일 주소를 입력하고 다시 시도한다.

A3: 비밀번호 보안 기준 미충족

1. 사용자가 비밀번호 재설정 폼에서 보안 기준을 충족하지 않는 비밀번호를 입력하고 “비밀번호 재설정” 버튼을 클릭한다.
2. 시스템은 “비밀번호는 최소 8자 이상이어야 하며, 대문자, 소문자, 숫자, 특수 문자를 포함해야 합니다.“라는 오류 메시지를 표시한다.
3. 사용자는 보안 기준을 충족하는 비밀번호를 입력하고 다시 시도한다.

A4: 비밀번호 불일치

1. 사용자가 비밀번호 재설정 폼에서 비밀번호와 비밀번호 확인 필드에 일치하지 않는 값을 입력하고 “비밀번호 재설정” 버튼을 클릭한다.
2. 시스템은 “비밀번호가 일치하지 않습니다.“라는 오류 메시지를 표시한다.
3. 사용자는 비밀번호를 일치시켜 다시 시도한다.

A5: 비밀번호 재설정 토큰 만료

1. 사용자가 비밀번호 재설정 링크를 클릭했을 때, 해당 토큰이 만료되었음을 시스템이 감지한다.
2. 시스템은 “비밀번호 재설정 링크가 만료되었습니다. 다시 비밀번호 재설정 요청을 해주세요.“라는 오류 메시지를 사용자에게 표시한다.
3. 사용자는 다시 비밀번호 재설정 요청을 한다.

A6: 비밀번호 재설정 토큰이 이미 사용된 경우

1. 사용자가 비밀번호 재설정 링크를 클릭했을 때, 해당 토큰이 이미 사용되었음을 시스템이 감지한다.
2. 시스템은 “비밀번호 재설정 링크가 이미 사용되었습니다. 다시 비밀번호 재설정 요청을 해주세요.“라는 오류 메시지를 사용자에게 표시한다.
3. 사용자는 다시 비밀번호 재설정 요청을 한다.

A7: 이메일 이미 사용 중

1. 사용자가 비밀번호 재설정 요청 시, 입력한 이메일 주소가 시스템에 존재하지 않을 경우.
2. 시스템은 “입력된 이메일 주소가 등록되지 않았습니다.“라는 오류 메시지를 표시한다.
3. 사용자는 이메일 주소를 확인하고 다시 시도하거나, 새로운 계정을 생성한다.

A8: 이메일 전송 실패

1. 시스템이 비밀번호 재설정 이메일 전송 과정에서 실패한다.
2. 시스템은 “비밀번호 재설정 이메일 전송에 실패했습니다. 나중에 다시 시도해주세요.“라는 오류 메시지를 사용자에게 표시한다.
3. 사용자는 나중에 다시 시도하거나, 지원 팀에 문의할 수 있다.

## 7. 예외 흐름

E1: 데이터베이스 오류

1. 시스템이 비밀번호 재설정 토큰을 생성하거나 저장하는 과정에서 데이터베이스 오류가 발생한다.
2. 시스템은 “시스템 오류가 발생했습니다. 나중에 다시 시도해주세요.“라는 오류 메시지를 사용자에게 표시한다.
3. 사용자는 나중에 다시 시도한다.

E2: 이메일 서비스 오류

1. 시스템이 비밀번호 재설정 이메일을 전송하는 과정에서 이메일 서비스 오류가 발생한다.
2. 시스템은 “비밀번호 재설정 이메일 전송 중 오류가 발생했습니다. 나중에 다시 시도해주세요.“라는 오류 메시지를 사용자에게 표시한다.
3. 사용자는 나중에 다시 시도하거나, 지원 팀에 문의할 수 있다.

## 8. 특별한 요구 사항

* 보안:
  * 비밀번호 재설정 토큰은 고유하고 예측 불가능해야 하며, 암호화되어 저장되어야 한다.
  * 비밀번호 재설정 링크는 HTTPS를 통해 암호화된 채널로 전송되어야 한다.
  * 비밀번호는 안전한 해시 알고리즘(예: bcrypt, Argon2)으로 해시화하여 저장한다.
  * 비밀번호 재설정 토큰은 일정 기간(예: 24시간) 후 자동으로 만료되도록 설정한다.
  * 비밀번호 재설정 요청 시, 비밀번호 재설정 이메일 내용은 안전하게 구성되어야 하며, 토큰이 노출되지 않도록 주의한다.

## 9. 비즈니스 규칙

* 비밀번호 재설정 요청 제한:
  * 일정 시간 내에 비밀번호 재설정 요청 횟수를 제한하여, 무분별한 요청으로 인한 서비스 남용을 방지한다.
* 비밀번호 재설정 토큰 유효성:
  * 비밀번호 재설정 토큰은 생성 후 일정 시간(예: 24시간) 내에만 유효하며, 그 이후에는 자동으로 만료된다.
* 토큰 재사용 방지:
  * 비밀번호 재설정 토큰은 한 번 사용된 후, 즉시 무효화되어 재사용이 불가능하도록 한다.
* 이메일 중복 방지:
  * 하나의 이메일 주소는 하나의 사용자 계정에만 연결될 수 있다.
* 비밀번호 보안 정책:
  * 비밀번호는 최소 8자 이상이어야 하며, 대문자, 소문자, 숫자, 특수 문자를 포함해야 한다.
  * 비밀번호 변경 시, 이전 비밀번호와 동일한 비밀번호를 사용할 수 없다.

## 10. 기술적 고려 사항

* 토큰 생성 및 관리:
  * 비밀번호 재설정 토큰은 고유하고, 충분히 긴 랜덤 문자열로 생성하여 예측 불가능하게 한다.
  * 토큰은 데이터베이스에 안전하게 저장되며, 만료 시간을 설정하여 일정 시간이 지나면 사용할 수 없도록 한다.
* 이메일 전송 서비스:
  * 신뢰할 수 있는 이메일 전송 서비스를 사용하여 비밀번호 재설정 이메일을 전송한다. (예: SendGrid, Amazon SES, Mailgun)
* 로깅 및 모니터링:
  * 비밀번호 재설정 요청 및 완료 과정을 로깅하여 보안 사고 발생 시 추적할 수 있도록 한다.
  * 비밀번호 재설정 요청의 빈도와 패턴을 모니터링하여 잠재적인 보안 위협을 탐지한다.
* 세션 관리:
  * 비밀번호 재설정 완료 후, 사용자의 기존 세션을 무효화하고 새로운 세션을 생성하여 보안을 강화한다.
* API 문서화:
  * 비밀번호 재설정 관련 API 엔드포인트에 대한 명확하고 상세한 문서를 제공하여 프론트엔드 개발자와의 협업을 원활하게 한다.
  * Swagger 또는 OpenAPI와 같은 도구를 사용하여 API 문서를 자동으로 생성하고 유지관리한다.
