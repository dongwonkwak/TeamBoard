# 회원 가입

## 1. 목적

사용자가 시스템에 새 계정을 생성하여 서비스를 이용할 수 있도록 한다.

## 2. 주요 참여자

* 사용자
* 시스템

## 3. 선행 조건

* 사용자가 인터넷에 접속해 있으며, 회원 가입 페이지에 접근할 수 있어야 한다.
* 사용자가 유효한 이메일 주소를 가지고 있어야 한다.

## 4. 후행 조건

* 사용자의 계정이 생성되고, 사용자 정보가 데이터베이스에 저장된다.
* 사용자는 이메일을 통해 계정 활성화 링크를 받게 된다.
* 사용자가 이메일 링크를 클릭하여 계정을 활성화하면, 계정이 활성화되고 로그인이 가능해 진다.

## 5. 기본 흐름

1. 사용자는 웹사이트에서 "회원 가입" 버튼을 클릭한다.
2. 시스템은 회원 가입 폼을 표시한다.
3. 사용자는 다음과 같은 필수 정보를 입력한다.
    * 사용자 이름(username)
    * 이메일 주소(Email address)
    * 비밀번호(Password)
    * 비밀번호 확인(Confirm Password)
4. 사용자는 "가입하기" 버튼을 클릭한다.
5. 시스템은 입력된 정보를 검증한다.
    * 모든 필수 할목이 입력되었는지 확인
    * 이메일 형식이 유효한지 확인
    * 비밀번호가 보안기준을 충족하는지 확인
    * 비밀번호와 비밀번호 확인이 일치하는지 확인
    * 이미 가입되어 있는 이메일인지 확인
6. 시스템이 모든 검증을 통과하면, 사용자 정보를 데이터베이스에 저장한다.
7. 시스템은 이메일 인증 토큰을 생성하고, 이를 포함한 이메일 인증 링크를 사용자에게 전송한다.
8. 시스템은 "회원 가입이 완료되었습니다. 이메일을 확인하여 계정을 활성화해주세요." 라는 확인 메시지를 사용자에게 전송한다.
9. 사용자는 이메일을 확인하고 활성화 링크를 클릭한다.
10. 시스템은 활성화 토큰을 검증하고, 계정을 활성화 한다.

## 6. 대안 흐름

A1: 필수 필드 미입력

1. 사용자가 필수 필드를 모두 입력하지 않고 "가입하기" 버튼을 누른다.
2. 시스템은 누락된 필드를 강조하고, "모든 필드를 입력해주세요"라는 오류 메시지를 표시한다.
3. 사용자는 누락된 정보를 입력하고 다시 시도한다.

A2: 비밀번호 보안 기준 미충족

1. 사용자가 보안 기준을 충족하지 않는 비밀번호를 입력하고 "가입하기" 버튼을 클릭한다.
2. 시스템은 "비밀번호는 최소 8자 이상이어야 하며, 대문자, 소문자, 숫자, 특수 문자를 포함해야 합니다" 라는 오류 메시지를 표시한다.
3. 사용자는 보안 기준을 충족하는 비밀번호를 입력하고 다시 시도한다.

A3: 비밀번호 불일치

1. 사용자가 비밀번호와 비밀번호 확인 필드에 일치하지 않는 값을 입력하고 "가입하기" 버튼을 누른다.
2. 시스템은 "비밀번호가 일치하지 않습니다."라는 오류 메시지를 표시한다.
3. 사용자는 비밀번호를 일치시켜 다시 도전한다.

A4: 이메일 형식 불일치

1. 사용자가 잘못된 형식의 이메일 주소를 입력하고 "가입하기" 버튼을 누른다.
2. 시스템은 "유효한 이메일 주소를 입력해주세요."라는 메시지를 표시한다.
3. 사용자는 올바른 이메일 주소를 입력하고 다시 시도한다.

A5: 이메일 이미 사용 중

1. 사용자가 이미 등록된 이메일 주소를 입력하고 "가입하기" 버튼을 클릭한다.
2. 시스템은 "해당 이메일 주소는 이미 사용 중입니다."라는 오류 메시지를 표시한다.
3. 사용자는 다른 이메일 주소를 사용하거나, "비밀번호 찾기" 기능을 통해 계정을 복구할 수 있다.

A6: 이메일 전송 실패

1. 시스템이 이메일 인증 링크 전송에 실패한다.
2. 시스템은 다음과 같은 조치를 취한다.
     * 로그 기록: 이메일 전송 실패에 대한 로그를 기록한다.
     * 사용자 알림: 사용자에게 이메일 전송 실패를 알리고, 재전송을 시도하거나 다른 조치를 안내하는 메시지를 표시한다.
     * 재전송 시도: 일정 시간 간격으로 자동으로 이메일 전송을 재시도한다. (예:최대 3회)

A7: 사용자 이메일 확인 미완료

1. 시스템은 활성화 이메일이 전송되지 않아 사용자가 계쩡을 활성화하지 못한 상태를 감지한다.
2. 시스템은 사용자가 로그인 시도 시, 이메일 확인을 요구하는 메시지를 표시하고 호라성화 이메일을 재전송한다.

A8: 활성화 토큰 오류

* 오류 메시지 반환: "유효하지 않은 활성화 토큰입니다"

## 7. 예외 흐름

E1: 데이터베이스 오류

1. 시스템이 이메일 인증 링크 전송에 실패한다.
2. 시스템은 "시스템 오류가 발생했습니다. 나중에 다시 시도해주세요."라는 오류 메시지를 표시한다.
3. 사용자는 나중에 다시 시도하거나, 지원팀에 문의할 수 있다.

## 8. 특별한 요구 사항

* 보안
  * 비밀번호는 안전한 해시 알고리즘으로 해시화하여 저장한다.
  * 이메일 인증 토큰은 고유하고 예측 불가능해야하며, 만료 시간을 설정하여 일정 시간이 지나면 사용할 수 없도록 한다.
* 사용자 경험
  * 실시간 입력 검증을 통해 사용자가 오류를 빠르게 인지하고 수정할 수 있도록 한다.
  * 이메일 인증 후 자동 로그인 페이지로 리디렉션한다.

## 9. 비즈니스 규칙

* 가입 조건
  * 사용자는 고유한 이메일 주소를 제공해야 한다.
  * 비밀번호는 최소 8자 이상이어야 하며, 대문자, 소문자, 숫자, 특수 문자를 포함해야 한다.
  * 비밀번호는 대문자, 소문자, 숫자, 특수문자로 구성되어 있다.
* 이메일 인증
  * 회원 가입 시 이메일 인증을 필수로 한다.
  * 인증되지 않은 계정은 로그인할 수 없으며, 이메일 인증을 완료해야 한다.
* 이메일 중복 방지
  * 하나의 이메일 주소는 하나의 사용자 계정에만 연결된 수 있다.

## 10. 기술적 고려 사항

* 이메일 전송 서비스
  * 실뢰할 수 있는 이메일 전송 서비스를 사용하여 이메일 인증 링크를 전송한다.
* 토큰 관리
  * 이메일 인증 토큰은 안전하게 생성되고, 저장되며, 만료 시간을 설정한다.
* 데이터베이스 스키마
  * Users 테이블에 이메일 인증 상태를 나타내는 필드를 추가한다.
